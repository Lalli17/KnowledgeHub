<h3 class="mb-4 text-primary">Review Articles</h3>

<!-- Success / Error messages -->
<div *ngIf="successMessage" class="alert alert-success alert-dismissible fade show" role="alert">
  {{ successMessage }}
  <button type="button" class="btn-close" (click)="successMessage=''" aria-label="Close"></button>
</div>
<div *ngIf="error" class="alert alert-danger alert-dismissible fade show" role="alert">
  {{ error }}
  <button type="button" class="btn-close" (click)="error=''" aria-label="Close"></button>
</div>

<!-- Bulk Select -->
<ng-container *ngIf="(pending?.length ?? 0) > 0; else emptyState">
  <div class="mb-3 d-flex align-items-center gap-2">
    <input type="checkbox" [checked]="allSelected" (change)="toggleAll($event)" />
    <label class="mb-0">Select All</label>
    <span class="ms-auto text-muted">{{ pending.length }} article(s) pending</span>
  </div>

  <!-- Table View -->
  <div class="table-responsive">
    <table class="table table-hover align-middle review-table">
      <thead>
        <tr>
          <th style="width: 40px;"></th>
          <th>Title</th>
          <th style="width: 160px;">Category</th>
          <th style="width: 140px;">Submitted</th>
          <th style="width: 220px;" class="text-end">Actions</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let p of pending; trackBy: trackByFn"
            [ngClass]="{
              'row-pending': !p.action || p.action==='Pending',
              'row-approved': p.action==='Approve',
              'row-rejected': p.action==='Reject'
            }">
          <td>
            <input type="checkbox" [(ngModel)]="p.selected" name="selected{{p.title}}" />
          </td>
          <td>
            <div class="title-cell">
              <a [href]="p.url" target="_blank" rel="noopener noreferrer" [attr.title]="p.title">
                {{ p.title }}
              </a>
            </div>
          </td>
          <td>
            <span class="badge"
                  [ngClass]="{
                    'bg-info': !p.action || p.action==='Pending',
                    'bg-success': p.action==='Approve',
                    'bg-danger': p.action==='Reject'
                  }"
                  [attr.title]="p.action || 'Pending'">
              {{ p.categoryName || 'General' }}
            </span>
          </td>
          <td>
            <span class="text-muted">{{ p.dateSubmitted ? timeAgo(p.dateSubmitted) : '-' }}</span>
          </td>
          <td class="text-end">
            <div class="btn-group btn-group-sm" role="group">
              <button class="btn btn-success" [disabled]="p.action==='Approve'" (click)="approveSingle(p)">Approve</button>
              <button class="btn btn-danger" [disabled]="p.action==='Reject'" (click)="rejectSingle(p)">Reject</button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Bulk Actions -->
  <div class="mt-3 d-flex gap-2 justify-content-end">
    <button class="btn btn-success" (click)="bulkApprove()" [disabled]="!anySelected">Approve Selected</button>
    <button class="btn btn-danger" (click)="bulkReject()" [disabled]="!anySelected">Reject Selected</button>
  </div>
</ng-container>

<!-- Empty State -->
<ng-template #emptyState>
  <div class="alert alert-info mt-3 text-center">No articles for reviewing.</div>
</ng-template>
